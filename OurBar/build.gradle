plugins {
  id 'org.jetbrains.kotlin.multiplatform'
  id 'org.jetbrains.kotlin.plugin.serialization'
  id 'com.android.library'
}

android {
  compileSdkVersion androidCompileSdkVersion
  defaultConfig {
    minSdkVersion androidMinSdkVersion

    sourceSets.main {
      java.srcDirs = ['src/androidMain/java']
      res.srcDirs = ['src/androidMain/res']
      jniLibs.srcDirs = ['src/androidMain/jniLibs']
      manifest.srcFile 'src/androidMain/AndroidManifest.xml'
    }
  }
  compileOptions {
    sourceCompatibility JavaVersion.VERSION_1_8
    targetCompatibility JavaVersion.VERSION_1_8
  }
  buildTypes {
    release {
      minifyEnabled false
      proguardFiles getDefaultProguardFile('proguard-android-optimize.txt')
    }
  }
}

kotlin {
  android("android")

  sourceSets {
    commonMain {
      dependencies {
        implementation 'org.jetbrains.kotlin:kotlin-stdlib-common'
        implementation "org.jetbrains.kotlinx:kotlinx-serialization-json:${kotlinx_serialization_version}"

        implementation('com.squareup.okhttp3:logging-interceptor:4.10.0')
      }
    }

    commonTest {
      dependencies {
        implementation kotlin("test") // This brings all the platform dependencies automatically

        implementation 'io.mockk:mockk:1.12.4'
      }
    }

    androidMain {
      dependencies {
        implementation 'org.jetbrains.kotlin:kotlin-stdlib-jdk8'

        implementation 'com.tencent:mmkv:1.2.13'

        api project(':bt-android')
      }
    }
  }
}

tasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile).all {
  kotlinOptions {
    jvmTarget = "1.8"
  }
}

configurations {
  compile.exclude group: 'org.json', module: 'json'
}
